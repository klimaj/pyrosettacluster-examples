<ROSETTASCRIPTS>
    Keywords: fragment picking, blueprint builder
    Author: Jason C. Klima

    This protocol sets up secondary structure energies, runs BluePrintBDR with a provided blueprint file, and then runs FastDesign with a provided resfile.

<SCOREFXNS>
    <ScoreFunction name="sfxn_std" weights="beta_nov16"/>
    <ScoreFunction name="sfxn1" weights="fldsgn_cen">
        <Reweight scoretype="hbond_sr_bb" weight="1.0" />
        <Reweight scoretype="hbond_lr_bb" weight="1.0" />
        <Reweight scoretype="atom_pair_constraint" weight="1.0" />
        <Reweight scoretype="angle_constraint" weight="1.0" />
        <Reweight scoretype="dihedral_constraint" weight="1.0" />
    </ScoreFunction>
</SCOREFXNS>

<RESIDUE_SELECTORS>
    <True name="true_selector"/>
    <Chain name="chA" chains="A"/>
</RESIDUE_SELECTORS>

<RESIDUE_LEVEL_TASK_OPERATIONS>
    <ExtraRotamersGenericRLT name="ex_rlt"
        ex1="0" ex2="0" ex3="0" ex4="0"
        ex1aro="0" ex1aro_exposed="0"
        ex2aro="0" ex2aro_exposed="0"
        ex1_sample_level="0"
        ex2_sample_level="0"
        ex3_sample_level="0"
        ex4_sample_level="0"
        ex1aro_sample_level="0"
        ex2aro_sample_level="0"
        ex1aro_exposed_sample_level="0"
        ex2aro_exposed_sample_level="0"
        extrachi_cutoff="18"/>
</RESIDUE_LEVEL_TASK_OPERATIONS>

<TASKOPERATIONS>
    <LimitAromaChi2 name="limitchi2" include_trp="1"/>
    <ReadResfile name="resfile" filename="{resfile}"/>
    <OperateOnResidueSubset name="ex"
        selector="true_selector"
        residue_level_operations="ex_rlt"/>
</TASKOPERATIONS>

<SIMPLE_METRICS>
    <RMSDMetric name="rmsd_all"
        robust="1"
        super="1"
        reference_name="store_native"
        rmsd_type="rmsd_all"/>
    <RMSDMetric name="rmsd_all_heavy"
        robust="1"
        super="1"
        reference_name="store_native"
        rmsd_type="rmsd_all_heavy"/>
    <RMSDMetric name="rmsd_protein_bb_ca"
        robust="1"
        super="1"
        reference_name="store_native"
        rmsd_type="rmsd_protein_bb_ca"/>
    <RMSDMetric name="rmsd_protein_bb_heavy"
        robust="1"
        super="1"
        reference_name="store_native"
        rmsd_type="rmsd_protein_bb_heavy"/>
    <RMSDMetric name="rmsd_protein_bb_heavy_including_O"
        robust="1"
        super="1"
        reference_name="store_native"
        rmsd_type="rmsd_protein_bb_heavy_including_O"/>
    <RMSDMetric name="rmsd_sc"
        robust="1"
        super="1"
        reference_name="store_native"
        rmsd_type="rmsd_sc"/>
    <RMSDMetric name="rmsd_sc_heavy"
        robust="1"
        super="1"
        reference_name="store_native"
        rmsd_type="rmsd_sc_heavy"/>
</SIMPLE_METRICS>

<MOVERS>
    <SavePoseMover name="save_native" restore_pose="0" reference_name="store_native"/>
    <Dssp name="dssp"/>
    <SetSecStructEnergies name="set_ssene1"
        scorefxn="sfxn1"
        blueprint="{blueprint}"/>
    <BluePrintBDR name="bdr"
        use_abego_bias="1"
        use_sequence_bias="1"
        scorefxn="sfxn1"
        blueprint="{blueprint}"/>
    <FastDesign name="fastdes"
        task_operations="ex,limitchi2,resfile"
        scorefxn="sfxn_std"
        relaxscript="MonomerRelax2019"
        clear_designable_residues="1"
        repeats="1"
        ramp_down_constraints="1"/>
</MOVERS>

<FILTERS>
    <ResidueCount name="nres" confidence="0"/>
    <ScoreType name="total_score" scorefxn="sfxn_std" score_type="total_score" threshold="99999" confidence="0"/>
    <CalculatorFilter name="total_score_res" threshold="0" equation="SCORE/RES" confidence="0">
        <Var name="SCORE" filter="total_score"/>
        <Var name="RES" filter="nres"/>
    </CalculatorFilter>
</FILTERS>

<PROTOCOLS>
    <Add mover="save_native"/>
    <Add mover="set_ssene1" />
    <Add mover="bdr"/>
    <Add mover="fastdes"/>
    <Add filter="nres"/>
    <Add filter="total_score_beta_jan25"/>
    <Add filter="total_score"/>
    <Add filter="total_score_res"/>
    <Add metrics="rmsd_all,rmsd_all_heavy,rmsd_protein_bb_ca,rmsd_protein_bb_heavy,rmsd_protein_bb_heavy_including_O,rmsd_sc,rmsd_sc_heavy"/>
</PROTOCOLS>

<OUTPUT scorefxn="sfxn_std"/>

</ROSETTASCRIPTS>
